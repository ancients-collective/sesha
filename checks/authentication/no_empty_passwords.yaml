id: no_empty_passwords
name: No empty password fields in /etc/shadow
author: sesha-project
version: "1.0"
description: Verify that no accounts have empty password fields, which allow passwordless login.
severity: critical
category: authentication
supported_os:
  - linux
tags:
  - cis-benchmark
  - hardening
  - passwords
  - access-control

steps:
  - function: file_not_contains
    args:
      path: /etc/shadow
      pattern: "^[^:]+::"

requirements:
  privilege: elevated
  note: Reading /etc/shadow requires root or shadow group membership.

impact: |
  Accounts with empty password fields can be logged into without any authentication. An attacker with local or network access (via SSH with PermitEmptyPasswords, or console) can gain a shell as any affected user â€” including service accounts with elevated privileges.
explain: |
  The second field in /etc/shadow stores the hashed password. When this field is empty (two consecutive colons like "user::"), the account has no password set. This is distinct from a locked account (which has ! or * in the field). Empty passwords are a critical finding because they bypass all authentication.
likelihood: likely
break_risk: |
  Locking an account with passwd -l may break services or cron jobs running as that user. Identify what each affected account runs before locking it. Consider setting a strong password instead if the account needs interactive access.
remediation: |
  List accounts with empty passwords:
    awk -F: '($2 == "") {print $1}' /etc/shadow
  Lock unused accounts:
    passwd -l <username>
  Or set a strong password:
    passwd <username>
  Verify the fix:
    awk -F: '($2 == "") {print $1}' /etc/shadow  # should return empty
references:
  - https://man7.org/linux/man-pages/man5/shadow.5.html
  - https://www.cisecurity.org/benchmark/distribution_independent_linux
